<html>
<head>
    <title>Inicio</title>
    <?php
        include '../modules/links.php';
    ?>
</head>
<?php
    include '../modules/nav.php';
?>
<body>
    <span class="wall">
        <span class="central-container">
            <span class="group-title">
                <span class="information">
                    <span class="name">Ogáldez</span>
                    <span class="members">11 integrantes</span>
                </span>
                
            </span>
            <span class="post-container me">
                <span id="8" class="post poll">
                    <span class="text">¿A dónde quieren salir en la noche?</span>
                    <form class="answers">
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll-0" type="radio" name="poll" value="0">
                                <label for="poll-0" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                Pollo Campero 
                            </span>
                            <span class="quantity">3</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll-1" type="radio" name="poll" value="1"> 
                                <label for="poll-1" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                Nais 
                            </span>
                            <span class="quantity">1</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll-2" type="radio" name="poll" value="2"> 
                                <label for="poll-2" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                La Estancia 
                            </span>
                            <span class="quantity">1</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                    </form>
                    <span class="time">12:35 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="9" class="post poll">
                    <span class="user-name">Henry</span>
                    <span class="text">¿A dónde quieren salir en la noche?</span>
                    <form class="answers">
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll-6" type="radio" name="poll" value="0">
                                <label for="poll-6" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                Pollo Campero 
                            </span>
                            <span class="quantity">3</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll-5" type="radio" name="poll" value="1"> 
                                <label for="poll-5" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                Nais 
                            </span>
                            <span class="quantity">1</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll-4" type="radio" name="poll" value="2"> 
                                <label for="poll-4" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                La Estancia 
                            </span>
                            <span class="quantity">1</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                    </form>
                    <span class="time">12:35 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="4" class="post question">
                    <span class="user-name">Henry</span>
                    <span class="text">¿A dónde quieren salir en la noche?</span>
                    <span class="options">
                        <a class="see-more">Respuestas</a>
                        <a class="answer">Responder</a>
                    </span>
                    <span class="answers">
                        <!-- Lista de respuestas de la pregunta -->
                        <span class="answer"><span class="user">Alex</span> A Nais!!!</span>
                        <span class="answer me"> No sé de qué tengo ganas jajaja</span>
                        <span class="answer"><span class="user">Vilma</span> Mejor a Pollo Campero, más barato.</span>
                    </span>
                    <span class="time">10:27 AM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="3" class="post message">
                    <span class="user-name">Vilma</span>
                    <span class="text">Hola ¿Cómo estás? ¿Cómo te ha ido? aaaaaaaa jajajaja wuuuuuuuuuuu</span>
                    <span class="time">3:15 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container me">
                <span id="2" class="post message">
                    <span class="text">Adiós</span>
                    <span class="time">3:15 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="1" class="post message">
                    <span class="user-name">Vilma</span>
                    <span class="text">Adiós ): </span>
                    <span class="time">3:15 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="5" class="post message">
                    <span class="user-name">Vilma</span>
                    <span class="text">Adiós ): </span>
                    <span class="time">3:15 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="6" class="post message">
                    <span class="user-name">Vilma</span>
                    <span class="text">Adiós ): </span>
                    <span class="time">3:15 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="7" class="post message">
                    <span class="user-name">Vilma</span>
                    <span class="text">Adiós ): </span>
                    <span class="time">3:15 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
        </span>
    </span>
    <span class="chatbox-container">
        <span class="chatbox">
            <input type="text" class="chatbox-input" placeholder="Escribe un mensaje">
            <a class="btn-chat"><i class="fas fa-paperclip"></i></a>
        </span>
        <span class="questionbox-container">
            <span class="questionbox">Pregunta</span>
        </span>
    </span>
</body>
</html>

<script>
    var question;
    var postId;
    var object;
    var quantity;
    var quantities = [];
    var sum;

    function updatePercents(post){
        object = $('#' + post).children('.answers').find('.answer');
        object.each(function(){
            quantity = $(this).children('.quantity').text();
            quantities.push(quantity);
            sum += parseInt(quantity);
        });
        object.each(function(){
            quantity = $(this).children('.quantity').text();
            quantity = Math.round((quantity / sum) * 100);
            $(this).children('.percent-container').children('.percent').css('width', quantity + '%');
        });
    }
    
    $(document).ready(function(){
        //Variable que indica que estamos en el wall de un grupo.
        wall = 1;

        //Función que se llama al dar click en la opción responder de las preguntas y muestra la pregunta sobre el chatbox.
        $('.answer').click(function(){
            if($(this).parent().parent().hasClass('question')){
                question = $(this).parent().parent().children('.text').html();
                postId = $(this).parent().parent().prop('id');
                $('.questionbox').html(question);
                $('.questionbox-container').css('bottom', '55px');
                $('.chatbox-input').prop('placeholder', 'Responde la pregunta');
                $('.chatbox-input').prop('id', postId);
                triggerMask('questionbox');
            }
        });

        $('.see-more').click(function(){
            object = $(this).parent().parent().children('.answers');
            if(object.css('height') == '0px'){
                object.css('height','auto');
            }else{
                object.css('height','0');
            }
        });

        //Función que se llama al presionar enter en el chat y obtiene el texto en la variable [text]. Si es una respuesta obtiene el id de la pregunta en la variable [postId] y agrega el comentario debajo de la pregunta.
        $('.chatbox-input').keyup(function(e){
            if(e.keyCode == 13)
            {
                text = $(this).val();
                if($(this).is('[id]')){
                    postId = $(this).prop('id');
                    console.log('Pregunta: ' + postId);
                    console.log('Respuesta: ' + text);
                    $('#' + postId).children('.answers').prepend('<span class="answer me">' + text + '</span>');
                    //Se esconde la pregunta.
                    $('.questionbox-container').css('bottom', '20px');
                    $('.chatbox-input').prop('placeholder', 'Escribe un mensaje');
                    $('.chatbox-input').removeAttr('id');
                    deactivateMask();
                }else{
                    console.log('Mensaje: ' + text);
                }
                $(this).val('');
                $(this).trigger("enterKey");
            }
        });

        $('.radio-button').click(function(){
            object = $(this).parent().parent();
            postId = object.parent().parent().prop('id');
            if(!object.parent().hasClass('answered')){
                quantity = parseInt(object.children('.quantity').text()) + 1;
                object.children('.quantity').html(quantity);
                object.parent().addClass('answered');
                object.addClass('selected');
            }else{
                if(!object.hasClass('selected')){
                    quantity = parseInt(object.children('.quantity').text()) + 1;
                    object.children('.quantity').html(quantity);
                    quantity = parseInt(object.parent().children('.selected').children('.quantity').text()) - 1;
                    object.parent().children('.selected').children('.quantity').html(quantity);
                    object.parent().children('.selected').removeClass('selected');
                    object.addClass('selected');
                }
            }
            sum = 0;
            updatePercents(postId);
        });
    });

    
</script>