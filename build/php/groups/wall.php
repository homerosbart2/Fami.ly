<html>
<head>
    <title>Inicio</title>
<?php
    include '../modules/nav.php';
?>
<body>
    <span class="wall">
        <span class="central-container">
            <span class="group-title">
                <span class="information">
                    <span class="name">Ogáldez</span>
                    <span class="members">11 integrantes</span>
                </span>
            </span>
            <span class="post-container me">
                <span id="11" class="post event">
                    <span class="event-date">
                        <i class="far fa-calendar"></i> 20 de marzo
                    </span>
                    <span class="text">¡Cumpleaños de Fernando!</span>
                    <span class="extra-information">
                        <span class="description">
                            Va a estar muy alegre, vengan todos!!
                        </span>
                        <span class="event-place">
                            <i class="fas fa-map-marker-alt"></i> Villas de Fátima
                        </span>
                        <span class="event-time">
                            <i class="far fa-clock"></i> 1:00 PM
                        </span>
                    </span>
                    <span class="options">
                        <a class="confirmed">Confirmados <i class="fas fa-angle-down"></i></a>
                        <a class="assist">Asistiré</a>
                    </span>
                    <span class="confirmed-users">
                        <!-- Lista de respuestas de la pregunta -->
                        <span class="user-container">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/face8.png">
                            <span class="name">Lilly</span>
                        </span>
                        <span class="user-container">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/face1.png">
                            <span class="name">Alex</span>
                        </span>
                        <span class="user-container">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/face2.png">
                            <span class="name">Vilma</span>
                        </span>
                        <span class="user-container">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/face9.png">
                            <span class="name">Jhonathan</span>
                        </span>
                        <span class="user-container me">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/profile.png">
                            <span class="name">Has indicado que asistirás a este evento.</span>
                        </span>
                    </span>
                    <span class="time">10:27 AM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="10" class="post event im-in">
                    <span class="user-name">Marco</span>
                    <span class="event-date">
                        <i class="far fa-calendar"></i> 20 de marzo
                    </span>
                    <span class="text">¡Cumpleaños de Fernando!</span>
                    <span class="extra-information">
                        <span class="description">
                            Va a estar muy alegre, vengan todos!!
                        </span>
                        <span class="event-place">
                            <i class="fas fa-map-marker-alt"></i> Villas de Fátima
                        </span>
                        <span class="event-time">
                            <i class="far fa-clock"></i> 1:00 PM
                        </span>
                    </span>
                    <span class="options">
                        <a class="confirmed">Confirmados <i class="fas fa-angle-down"></i></a>
                        <a class="assist">No Asistiré</a>
                    </span>
                    <span class="confirmed-users">
                        <!-- Lista de respuestas de la pregunta -->
                        <span class="user-container">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/face8.png">
                            <span class="name">Lilly</span>
                        </span>
                        <span class="user-container">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/face1.png">
                            <span class="name">Alex</span>
                        </span>
                        <span class="user-container">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/face2.png">
                            <span class="name">Vilma</span>
                        </span>
                        <span class="user-container">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/face9.png">
                            <span class="name">Jhonathan</span>
                        </span>
                        <span class="user-container me">
                            <i class="far fa-check-square"></i>
                            <img class="user" src="../../assets/img/users/profile.png">
                            <span class="name">Has indicado que asistirás a este evento.</span>
                        </span>
                    </span>
                    <span class="time">10:27 AM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container me">
                <span id="9" class="post question">
                    <span class="text">¿A dónde quieren salir en la noche?</span>
                    <span class="options">
                        <a class="see-more">Respuestas</a>
                        <a class="answer">Responder</a>
                    </span>
                    <span class="answers">
                        <!-- Lista de respuestas de la pregunta -->
                        <span class="answer"><span class="user">Alex</span> A Nais!!!</span>
                        <span class="answer me"> No sé de qué tengo ganas jajaja</span>
                        <span class="answer"><span class="user">Vilma</span> Mejor a Pollo Campero, más barato.</span>
                    </span>
                    <span class="time">10:27 AM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container me">
                <span id="8" class="post poll">
                    <span class="text">¿A dónde quieren salir en la noche?</span>
                    <form class="answers">
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll8-0" type="radio" name="poll" value="0">
                                <label for="poll8-0" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                Pollo Campero 
                            </span>
                            <span class="quantity">3</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll8-1" type="radio" name="poll" value="1"> 
                                <label for="poll8-1" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                Nais 
                            </span>
                            <span class="quantity">1</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll8-2" type="radio" name="poll" value="2"> 
                                <label for="poll8-2" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                La Estancia 
                            </span>
                            <span class="quantity">1</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                    </form>
                    <span class="time">12:35 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="20" class="post poll">
                    <span class="user-name">Henry</span>
                    <span class="text">¿A dónde quieren salir en la noche?</span>
                    <form class="answers">
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll20-0" type="radio" name="poll" value="0">
                                <label for="poll20-0" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                Pollo Campero 
                            </span>
                            <span class="quantity">3</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll20-1" type="radio" name="poll" value="1"> 
                                <label for="poll20-1" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                Nais 
                            </span>
                            <span class="quantity">1</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                        <span class="answer">
                            <span class="radio-container">
                                <input id="poll20-2" type="radio" name="poll" value="2"> 
                                <label for="poll20-2" class="radio-button" >
                                    <i class="fas fa-check-circle"></i>
                                </label>
                                La Estancia 
                            </span>
                            <span class="quantity">1</span>
                            <span class="percent-container">
                                <span class="percent"></span>
                            </span>
                        </span>
                    </form>
                    <span class="time">12:35 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="4" class="post question">
                    <span class="user-name">Henry</span>
                    <span class="text">¿A dónde quieren salir en la noche?</span>
                    <span class="options">
                        <a class="see-more">Respuestas</a>
                        <a class="answer">Responder</a>
                    </span>
                    <span class="answers">
                        <!-- Lista de respuestas de la pregunta -->
                        <span class="answer"><span class="user">Alex</span> A Nais!!!</span>
                        <span class="answer me"> No sé de qué tengo ganas jajaja</span>
                        <span class="answer"><span class="user">Vilma</span> Mejor a Pollo Campero, más barato.</span>
                    </span>
                    <span class="time">10:27 AM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="3" class="post message">
                    <span class="user-name">Vilma</span>
                    <span class="text">Hola ¿Cómo estás? ¿Cómo te ha ido? aaaaaaaa jajajaja wuuuuuuuuuuu</span>
                    <span class="time">3:15 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container me">
                <span id="2" class="post message">
                    <span class="text">Adiós</span>
                    <span class="time">3:15 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
            <span class="post-container">
                <span id="1" class="post message">
                    <span class="user-name">Vilma</span>
                    <span class="text">Adiós ): </span>
                    <span class="text">Adiós ): </span>
                    <span class="text">Adiós ): </span>
                    <span class="text">Adiós ): </span>
                    <span class="time">3:15 PM</span>
                    <span class="type"><i class="fas fa-circle"></i></span>
                </span>   
            </span>
        </span>
    </span>
    <span class="chatbox-container">
        <span class="chatbox">
            <input type="text" class="chatbox-input" placeholder="Escribe un mensaje">
            <a class="btn-chat"><i class="fas fa-paperclip"></i></a>
        </span>
        <span class="questionbox-container">
            <span class="questionbox">Pregunta</span>
        </span>
        <span class="post-form-container">
            <span class="form-container">
                <span class="arrow left-arrow">
                    <i class="fas fa-arrow-left"></i>
                </span>
                <span class="inputs-container">
                    <span class="inputs-left">
                        <span class="form">
                            <span class="form-title">
                                Votación
                            </span>
                        </span>
                    </span>
                    <span class="inputs-center">
                        <span class="form">
                            <span class="form-title">
                                Evento
                            </span>
                        </span>
                    </span>
                    <span class="inputs-right">
                        <span class="form">
                            <span class="form-title">
                                Imagen o Video
                            </span>
                        </span>
                    </span>
                </span>
                <span class="arrow right-arrow">
                    <i class="fas fa-arrow-right"></i>
                </span>
            </span>
        </span>
    </span>
</body>
</html>

<script>
    var question;
    var postId;
    var quantity;
    var quantities = [];
    var sum;

    function updatePercents(post){
        object = $('#' + post).children('.answers').find('.answer');
        object.each(function(){
            quantity = $(this).children('.quantity').text();
            quantities.push(quantity);
            sum += parseInt(quantity);
        });
        object.each(function(){
            quantity = $(this).children('.quantity').text();
            quantity = Math.round((quantity / sum) * 100);
            $(this).children('.percent-container').children('.percent').css('width', quantity + '%');
            
        });
    }
    
    $(document).ready(function(){
        //Variable que indica que estamos en el wall de un grupo.
        wall = 1;

        //Función que se llama al dar click en la opción responder de las preguntas y muestra la pregunta sobre el chatbox.
        $('.answer').click(function(){
            if($(this).parent().parent().hasClass('question')){
                question = $(this).parent().parent().children('.text').html();
                postId = $(this).parent().parent().prop('id');
                $('.questionbox').html(question);
                $('.questionbox-container').css('bottom', '55px');
                $('.chatbox-input').prop('placeholder', 'Responde la pregunta');
                $('.chatbox-input').prop('id', postId);
                triggerMask('questionbox');
            }
        });

        $('.see-more').click(function(){
            object = $(this).parent().parent().children('.answers');
            if(object.css('height') == '0px'){
                object.css('height','auto');
            }else{
                object.css('height','0');
            }
        });

        //Función que se llama al presionar enter en el chat y obtiene el texto en la variable [text]. Si es una respuesta obtiene el id de la pregunta en la variable [postId] y agrega el comentario debajo de la pregunta.
        $('.chatbox-input').keyup(function(e){
            if(e.keyCode == 13)
            {
                text = $(this).val();
                if($(this).is('[id]')){
                    postId = $(this).prop('id');
                    console.log('Pregunta: ' + postId);
                    console.log('Respuesta: ' + text);
                    $('#' + postId).children('.answers').prepend('<span class="answer me">' + text + '</span>');
                    //Se esconde la pregunta.
                    $('.questionbox-container').css('bottom', '20px');
                    $('.chatbox-input').prop('placeholder', 'Escribe un mensaje');
                    $('.chatbox-input').removeAttr('id');
                    deactivateMask();
                }else{
                    console.log('Mensaje: ' + text);
                }
                $(this).val('');
                $(this).trigger("enterKey");
            }
        });

        $('.radio-button').click(function(){
            object = $(this).parent().parent();
            postId = object.parent().parent().prop('id');
            if(!object.parent().hasClass('answered')){
                quantity = parseInt(object.children('.quantity').text()) + 1;
                object.children('.quantity').html(quantity);
                object.parent().addClass('answered');
                object.addClass('selected');
            }else{
                if(!object.hasClass('selected')){
                    quantity = parseInt(object.children('.quantity').text()) + 1;
                    object.children('.quantity').html(quantity);
                    quantity = parseInt(object.parent().children('.selected').children('.quantity').text()) - 1;
                    object.parent().children('.selected').children('.quantity').html(quantity);
                    object.parent().children('.selected').removeClass('selected');
                    object.addClass('selected');
                }
            }
            sum = 0;
            updatePercents(postId);
        });


        $('.confirmed').click(function(){
            if(!$(this).hasClass('expanded')){
                $(this).html('Confirmados <i class="fas fa-angle-up"></i>');
                $(this).parent().parent().children('.confirmed-users').css('flex-direction','column-reverse');
                $(this).parent().parent().children('.confirmed-users').find('.user-container').each(function(){
                    $(this).children('.user').css('width', '40px');
                    $(this).children('.user').css('height', '40px');
                    $(this).children('.user').css('margin-top', '3px');
                    $(this).children('.user').css('margin-bottom', '3px');
                    $(this).children('.user').css('margin-left', '1px');
                    $(this).children('.name').css('display', 'flex');
                    $(this).children('i').css('display', 'flex');
                });
                $(this).addClass('expanded');
            }else{
                $(this).html('Confirmados <i class="fas fa-angle-down"></i>');
                $(this).parent().parent().children('.confirmed-users').css('flex-direction','row');
                $(this).parent().parent().children('.confirmed-users').find('.user-container').each(function(){
                    object = $(this).children('.user');
                    if($(this).hasClass('me')){
                        object.css('margin-left', '12px');
                    }
                    object.css('width', '20px');
                    object.css('height', '20px');
                    object.css('margin-top', '1px');
                    object.css('margin-bottom', '1px');
                    $(this).children('.name').css('display', 'none');
                    $(this).children('i').css('display', 'none');
                });
                $(this).removeClass('expanded');
            }
        });

        $('.assist').click(function(){
            object = $(this).parent().parent();
            if(object.hasClass('im-in')){
                object.removeClass('im-in');
                $(this).html('Asisitiré');
            }else{
                object.addClass('im-in');
                $(this).html('No Asisitiré');
            }
        });

        $('.btn-chat').click(function(){
            object = $('.chatbox-container');
            if(!object.hasClass('expanded')){
                object.addClass('expanded');
                $('.main-nav').addClass('post-form-expanded');
                $('.the-line').css('top', '-55px');
                $('.main-nav').css('top', '-59px');
                $(this).html('<i class="fas fa-location-arrow"></i>');
                $('body').addClass('disableScrollBar');
            }else{
                //Acciones que se realizan al presionar el botón de enviar.
                object.removeClass('expanded');
                $('.main-nav').removeClass('post-form-expanded');
                $('.the-line').css('top', '0');
                $('.main-nav').css('top', '4px');
                $(this).html('<i class="fas fa-paperclip"></i>');
                $('body').removeClass('disableScrollBar');
            }
        });

        $('.left-arrow').children('i').click(function(){
            $('.inputs-right').css('opacity', '1');
            $('.inputs-left').css('opacity', '0');
            object = $('.inputs-center');
            object.addClass('lock');
            object.toggleClass('inputs-center inputs-left');
            $('.inputs-right').toggleClass('inputs-right inputs-center');
            $('.inputs-left').each(function(){
                if(!$(this).hasClass('lock')){
                    $(this).toggleClass('inputs-left inputs-right');
                }
            });
            object.removeClass('lock');
        });

        $('.right-arrow').children('i').click(function(){
            $('.inputs-left').css('opacity', '1');
            $('.inputs-right').css('opacity', '0');
            object = $('.inputs-center');
            object.addClass('lock');
            object.toggleClass('inputs-center inputs-right');
            $('.inputs-left').toggleClass('inputs-left inputs-center');
            $('.inputs-right').each(function(){
                if(!$(this).hasClass('lock')){
                    $(this).toggleClass('inputs-right inputs-left');
                }
            });
            object.removeClass('lock');
        });

    });

    
</script>